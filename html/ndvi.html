<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA-Powered Pollen Forecast for Hay Fever</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: #EDE6D6;
            min-height: 100vh;
            /* padding: 20px; */
            background-image: url('../assets/cartographer (1).png');
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        nav {
            width: auto;
            background: #18392B;
            padding: 1rem 0;
            position: relative;
        }

        .logo {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            height: 50px;
            width: auto;
        }

        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            gap: 2rem;
        }

        nav a {
            color: #F5F5DC;
            text-decoration: none;
            padding: 0.5rem 1rem;
        }

        nav a:hover {
            background: #7A8471;
        }

        h1 {
            color: #18392B;
            font-size: 2em;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .sources {
            color: #666;
            font-size: 0.9em;
            font-weight: 300;
            font-style: italic;
        }

        .nasa-logo {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 80px;
            z-index: 1000;
        }

        .controls {
            text-align: center;
            margin: 0 auto 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(24, 57, 43, 0.1);
            max-width: 600px;
            border: 2px solid #18392B;
        }

        .controls label {
            font-weight: 500;
            color: #18392B;
            font-size: 1em;
            margin-right: 15px;
        }

        #dateSlider {
            width: 300px;
            height: 6px;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            background: #18392B;
            cursor: pointer;
        }

        #dateSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #18392B;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        #dateSlider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #18392B;
            cursor: pointer;
            border: none;
        }

        #selectedDate {
            display: inline-block;
            margin-left: 15px;
            font-weight: 700;
            color: #18392B;
            font-size: 1em;
            background: #EDE6D6;
            padding: 6px 14px;
            border-radius: 6px;
        }

        .visualization-wrapper {
            max-width: 1400px;
            margin: 0 auto 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(24, 57, 43, 0.1);
            border: 2px solid #18392B;
        }

        .visualization-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        #map {
            flex: 1;
            min-width: 300px;
            height: 500px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #18392B;
        }

        #chart {
            flex: 1;
            min-width: 300px;
            height: 500px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            position: relative;
            background: #f9f9f9;
            border-radius: 8px;
            padding: 40px 60px 60px 80px;
            border: 2px solid #18392B;
        }

        .legend {
            text-align: center;
            padding: 20px;
            border-top: 2px solid #EDE6D6;
        }

        .legend-title {
            font-weight: 500;
            color: #18392B;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .legend-items {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95em;
            color: #333;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .tips {
            max-width: 1400px;
            margin: 0 auto;
            font-size: 15px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(24, 57, 43, 0.1);
            border: 2px solid #18392B;
        }

        .tips-title {
            color: #18392B;
            font-size: 1.3em;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .tips ul {
            list-style: none;
            padding: 0;
        }

        .tips li {
            margin-bottom: 20px;
            padding-left: 0;
            line-height: 1.6;
        }

        .tips li b {
            font-size: 1em;
            display: block;
            margin-bottom: 5px;
        }

        .risk-high {
            color: #dc2626;
            font-weight: 500;
        }

        .risk-moderate {
            color: #f59e0b;
            font-weight: 500;
        }

        .risk-low {
            color: #16a34a;
            font-weight: 500;
        }

        .bar {
            display: inline-block;
            margin: 0 15px;
            position: relative;
        }

        .bar-inner {
            width: 50px;
            text-align: center;
            border-radius: 6px 6px 0 0;
        }

        .bar-label {
            position: absolute;
            bottom: -30px;
            font-weight: 500;
            color: #18392B;
            font-size: 0.85em;
            width: 100%;
            text-align: center;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            color: #18392B;
            font-weight: 700;
            font-size: 0.9em;
            width: 100%;
            text-align: center;
        }

        .y-axis {
            position: absolute;
            left: 20px;
            height: 360px;
            width: 50px;
            text-align: right;
            color: #18392B;
            font-weight: 500;
            padding-right: 10px;
            font-size: 0.9em;
        }

        .y-axis div {
            margin-bottom: 62px;
        }

        @media (max-width: 900px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.5em;
            }

            .visualization-container {
                flex-direction: column;
            }

            #map,
            #chart {
                width: 100%;
                min-width: 100%;
                height: 400px;
            }

            #chart {
                padding: 40px 40px 60px 60px;
            }

            .y-axis div {
                margin-bottom: 48px;
            }

            #dateSlider {
                width: 200px;
            }

            .legend-items {
                gap: 15px;
            }

            .nasa-logo {
                width: 60px;
                top: 10px;
                right: 10px;
            }

            .visualization-wrapper {
                padding: 20px;
            }
        }
    </style>
</head>
<nav>
    <img src="../assets/pam.png" alt="PAM Logo" class="logo">
    <ul>
        <li><a href="main.html">Home</a></li>
        <li><a href="types.html">Pollen Types</a></li>
        <li><a href="index.html">Pollen Map</a></li>
        <li><a href="ndvi.html">Forecast</a></li>
        <li><a href="about.html">About</a></li>
    </ul>
</nav>

<body>
    <img src="https://www.nasa.gov/wp-content/uploads/2023/03/nasa-logo-web-rgb.png" class="nasa-logo"
        alt="NASA Logo" />

    <div class="header" style="margin-top: 2em;">
        <h1>NASA Earth Data Pollen Forecast</h1>
        <div class="sources">Data Sources: https://appeears.earthdatacloud.nasa.gov/ | _250m_16_days_NDVI (MOD13Q1.061)
        </div>
    </div>

    <div class="controls">
        <label for="dateSlider">Select Date:</label>
        <input type="range" id="dateSlider" min="0" max="19" value="0">
        <span id="selectedDate"></span>
    </div>

    <div class="visualization-wrapper">
        <div class="visualization-container">
            <div id="map"></div>
            <div id="chart">
                <div class="y-axis">
                    <div>5</div>
                    <div>4</div>
                    <div>3</div>
                    <div>2</div>
                    <div>1</div>
                    <div>0</div>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-title">Pollen Index Legend</div>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background: #dc2626;"></div>
                    <span>High Risk (>4)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f59e0b;"></div>
                    <span>Moderate Risk (2-4)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #16a34a;"></div>
                    <span>Low Risk (≤2)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2563eb;"></div>
                    <span>Combined Index</span>
                </div>
            </div>
        </div>
    </div>

    <div class="tips">
        <div class="tips-title">Hay Fever Management Guide</div>
        <ul>
            <li>
                <b class="risk-high">High Risk (>4):</b>
                Stay indoors when possible, especially during peak pollen hours (5am-10am). Take prescribed
                antihistamines before symptoms start. Keep all windows and doors closed. Use air conditioning with HEPA
                filters. Shower and change clothes after being outside. Wear wraparound sunglasses to protect eyes.
            </li>
            <li>
                <b class="risk-moderate">Moderate Risk (2-4):</b>
                Monitor your symptoms closely and take antihistamines if needed. Limit outdoor activities during early
                morning and evening. Check pollen counts before planning outdoor activities. Keep car windows closed
                while driving. Consider wearing a mask outdoors if sensitive.
            </li>
            <li>
                <b class="risk-low">Low Risk (≤2):</b>
                Safe for most outdoor activities. Minimal precautions needed, but those highly sensitive should still be
                cautious. Good time for exercise and outdoor recreation. Consider opening windows for fresh air.
            </li>
        </ul>
    </div>

    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDof8QDt0_6EghBjqAucP4nnlKqN8cG5y0&callback=initMap"></script>
    <script>
        let map, allForecasts = [];
        const slider = document.getElementById('dateSlider');
        const dateLabel = document.getElementById('selectedDate');
        const chart = document.getElementById('chart');

        function getRiskLevel(index) {
            return index > 4 ? 'High Risk' : index > 2 ? 'Moderate Risk' : 'Low Risk';
        }

        function getMarkerIcon(color) {
            return `https://maps.google.com/mapfiles/ms/icons/${color}-dot.png`;
        }

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 32.7767, lng: -96.7970 },
                zoom: 10,
                mapTypeControl: false,
                attributionControl: false
            });
            const attribution = document.createElement('div');
            attribution.innerHTML = 'Data &copy; NASA MODIS';
            attribution.style.fontSize = '10px';
            attribution.style.padding = '2px';
            map.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(attribution);
// C:\Users\a00311387\Desktop\PAM\data\predicted_pollen_20days.json
            fetch('/data/predicted_pollen_20days.json')
                .then(response => response.json())
                .then(forecasts => {
                    allForecasts = forecasts;
                    const uniqueDates = [...new Set(forecasts.map(d => d.date))];
                    slider.max = uniqueDates.length - 1;
                    dateLabel.textContent = uniqueDates[0];

                    function updateDisplay(index) {
                        const date = uniqueDates[index];
                        dateLabel.textContent = date;

                        // Clear existing markers
                        map.markers = map.markers || [];
                        map.markers.forEach(marker => marker.setMap(null));
                        map.markers = [];

                        // Add marker
                        const entries = allForecasts.filter(d => d.date === date);
                        const maxIndex = Math.max(...entries.map(e => e.projected_index));
                        const color = maxIndex > 4 ? 'red' : maxIndex > 2 ? 'orange' : 'green';
                        let content = `<div style="font-family: 'Roboto', Arial, sans-serif; padding: 5px;">
                            <b style="color: #18392B; font-size: 16px;">${date} - Pollen Forecast</b><br><br>`;

                        entries.forEach(e => {
                            const riskColor = e.projected_index > 4 ? '#dc2626' : e.projected_index > 2 ? '#f59e0b' : '#16a34a';
                            const riskLevel = getRiskLevel(e.projected_index);
                            content += `<div style="margin: 8px 0; padding: 8px; background: #f9fafb; border-radius: 6px; border-left: 4px solid ${riskColor};">
                                <b style="color: ${riskColor};">${e.pollen_type}:</b> Index ${e.projected_index.toFixed(1)} - ${riskLevel}<br>
                                <small style="color: #6b7280;">NASA Vegetation: ${e.ndvi_influence}</small>
                            </div>`;
                        });

                        const highRisk = entries.some(e => e.projected_index > 4);
                        const modRisk = entries.some(e => e.projected_index > 2);
                        const tipColor = highRisk ? '#dc2626' : modRisk ? '#f59e0b' : '#16a34a';
                        let tipText = highRisk ?
                            '⚠️ Stay indoors, take antihistamines, keep windows closed' :
                            modRisk ?
                                '⚡ Monitor symptoms, limit outdoor time during peak hours' :
                                '✓ Safe for outdoor activities, minimal precautions needed';

                        content += `<div style="margin-top: 12px; padding: 10px; background: ${tipColor}15; border-radius: 6px; border: 2px solid ${tipColor};">
                            <b style="color: ${tipColor};">Recommendation:</b><br>
                            <span style="color: #374151;">${tipText}</span>
                        </div></div>`;

                        const infoWindow = new google.maps.InfoWindow({ content });
                        const marker = new google.maps.Marker({
                            position: { lat: 32.7767, lng: -96.7970 },
                            map,
                            icon: getMarkerIcon(color)
                        });
                        marker.addListener('click', () => infoWindow.open(map, marker));
                        map.markers.push(marker);

                        // Update bar chart
                        chart.innerHTML = '<div class="y-axis"><div>5</div><div>4</div><div>3</div><div>2</div><div>1</div><div>0</div></div>';
                        const types = ['TREE', 'GRASS', 'WEED', 'COMBINED'];
                        const colors = {
                            TREE: '#16a34a',
                            GRASS: '#f59e0b',
                            WEED: '#dc2626',
                            COMBINED: '#2563eb'
                        };
                        types.forEach(type => {
                            const bar = document.createElement('div');
                            bar.className = 'bar';
                            const entry = entries.find(d => d.pollen_type === type);
                            const value = entry.projected_index;
                            const height = (value / 5) * 360;

                            bar.innerHTML = `<div class="bar-inner" style="background:${colors[type]};height:${height}px;"></div>
                                            <div class="bar-label">${type}</div>
                                            <div class="bar-value">${value.toFixed(1)}</div>`;
                            chart.appendChild(bar);
                        });

                        // Highlight high weed index
                        const highWeed = entries.find(d => d.date === '2026-04-10' && d.pollen_type === 'WEED');
                        if (highWeed && date === highWeed.date) {
                            const note = document.createElement('div');
                            note.style.position = 'absolute';
                            note.style.top = '10px';
                            note.style.left = '50%';
                            note.style.transform = 'translateX(-50%)';
                            note.style.color = '#dc2626';
                            note.style.fontWeight = '700';
                            note.style.fontSize = '0.9em';
                            note.textContent = 'High Weed Risk Alert';
                            chart.appendChild(note);
                        }
                    }

                    slider.addEventListener('input', () => updateDisplay(slider.value));
                    updateDisplay(0);
                })
                .catch(error => console.error('Error loading JSON:', error));
        }
    </script>
</body>

</html>